---
title: '光线追踪'
date: '2022-11-04'
---


光栅化计算快速，而光线追踪质量更高，有阴影和面光源

ray casting 光线衍射，由眼睛点向屏幕(x,y)点发射一条光线，找到光线第一个击中的表面，用其光照计算(x,y)的颜色，可以计算半透明效果

如何表示一条光线：$p+td$，p是原点，d是方向

如何表示一个平面：含蓄$f(x)=0$，参数化$x=g(u,v)$

则$f(p+td)=0$或$p+td-g(u,v)=0$时光线经过平面

ray-sphere intersection $x^2+y^2+z^2-r^2=0$带入，求根公式可用

折射、反射

反锯齿

Depth of Field 视野深度

变换后的种类：三角形、球
椭球变换成球，求出与直线相交后反变换回去，得到椭球和直线的交点

每一根线有很多交点，优化的核心是数据结构，数据结构要满足：快速判断是否相交

一种想法是建立bounding box，判断光线与大盒子是否相交

盒子越紧越好，避免假阳性

一个想法是分层
大盒子套小盒子
而非直接判断其中的三角形
简称AABB
与坐标轴平面相平行方便计算
方便递归

BB是以物体为中心进行的划分

如上优化，多层网格，区别在空间结构相对固定

以数据结构来看，形成一个k叉树，二维4，三维8，八叉树octree

grid优点：规则，缺点：物体在空间中运动需要更改一整棵树

可以结合二者，静止用grid，动态用BB

一定使用octree？
分割不一定是规则的！
随着物体位置改变分割

- 直着不均分，k-d tree
- 斜着分，BSP tree

BSP图示，用线/面划分左边和右边，存在子节点中
叶子节点中存储空间中的对象，
划分后即分出光照到空间的先后次序

根节点对BSP tree有影响
尽量保持平衡
是一个优化问题

- 不用z-buffer，用数据结构进行排序
- 视线，自动排序，
先判断是否在视野范围内再处理，减少多余光线